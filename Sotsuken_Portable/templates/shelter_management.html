{% extends 'base.html' %}
{% load static %}

{% block title %}避難所管理{% endblock %}
{% block header_title %}避難所管理{% endblock %}

{% block content %}
<div class="p-4 md:p-8 max-w-4xl mx-auto">
    
    <!-- 新規避難所登録フォーム -->
    <form method="post" class="bg-white p-6 rounded-xl shadow-lg mb-8">
        {% csrf_token %}
        <h3 class="text-lg font-semibold mb-4 text-orange-700">新規避難所の登録</h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- {{ form.as_p }} を使う代わりに、TailwindCSSでスタイリングするために各フィールドを手動で描画 -->
            {% for field in form %}
            <div class="mb-2">
                <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ field.label }}</label>
                {{ field }}
                {% if field.name == 'is_pet_friendly' %}<span class="text-sm ml-2">はい</span>{% endif %}
                {% if field.errors %}
                    <p class="text-red-500 text-xs mt-1">{{ field.errors.as_text }}</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <button type="submit" class="mt-4 w-full bg-orange-500 text-white p-3 rounded-lg hover:bg-orange-600 transition-colors font-semibold">この内容で登録する</button>
    </form>

    <!-- 既存避難所リスト -->
    <div class="bg-white p-6 rounded-xl shadow-lg">
        <h3 class="text-lg font-semibold mb-2">登録済み避難所リスト</h3>
        <div class="overflow-x-auto">
            <table class="w-full min-w-[600px]">
                <thead>
                    <tr class="border-b">
                        <th class="p-2 text-left">避難所名</th>
                        <th class="p-2 text-center">最大収容人数</th>
                        <th class="p-2 text-center">現在の収容人数</th>
                        <th class="p-2 text-center">ペット可否</th>
                        <th class="p-2 text-center">操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% for shelter in shelter_list %}
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-2 font-semibold">{{ shelter.name }}</td>
                        <td class="p-2 text-center">{{ shelter.max_capacity }}人</td>
                        <td class="p-2 text-center">{{ shelter.current_occupancy }}人</td>
                         <td class="p-2 text-center">
                        {% if shelter.is_pet_friendly %}
                            <span class="inline-flex items-center px-3 py-1 text-sm rounded-full font-semibold bg-cyan-100 text-cyan-800">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                </svg>
                                可
                            </span>
                        {% else %}
                            <span class="inline-flex items-center px-3 py-1 text-sm rounded-full font-semibold bg-gray-200 text-gray-700">
                                不可
                            </span>
                        {% endif %}
                    </td>
                        <td class="p-2 text-center space-x-2">
                            <!-- 次のステップで実装する編集・削除ボタンを配置 -->
                            <a href="{% url 'Sotsuken_Portable:shelter_edit' shelter.id %}" class="inline-block bg-blue-500 text-white text-xs font-bold py-1 px-3 rounded-md hover:bg-blue-700">編集</a>
                            <a href="{% url 'Sotsuken_Portable:shelter_delete' shelter.id %}" class="inline-block bg-red-500 text-white text-xs font-bold py-1 px-3 rounded-md hover:bg-red-700">削除</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="5" class="p-4 text-center text-gray-500">登録されている避難所はありません。</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block body_extra %}
<style>
    /* フォームの入力欄にTailwindCSSのスタイルを一括で適用 */
    input[type="text"], input[type="number"], input[type="email"], input[type="url"], select {
        @apply mt-1 p-2 w-full border border-gray-300 rounded-lg;
    }
    input[type="checkbox"] {
        @apply h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500;
    }
</style>
{% endblock %}