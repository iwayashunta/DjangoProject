{% extends "base.html" %}
{% block title %}{{ group.name }} - グループ詳細{% endblock %}
{% block header_title %}{{ group.name }}{% endblock %}

{% block content %}
<div class="space-y-8">

    <div class="bg-purple-50 p-6 rounded-xl shadow-lg text-center border border-purple-300">
        <h2 class="text-xl font-bold mb-4 text-purple-800">グループチャット</h2>
        <p class="text-gray-700 mb-4">このグループのメンバーとリアルタイムで会話できます。</p>
        <a href="{% url 'Sotsuken_Portable:chat_room' group.pk %}" class="w-full md:w-auto bg-purple-600 text-white py-3 px-8 rounded-lg hover:bg-purple-700 font-semibold inline-block text-lg">
            チャットルームに入る
        </a>
    </div>
    <div class="bg-white p-6 rounded-xl shadow-lg">
        <h2 class="text-2xl font-bold mb-4">メンバー一覧</h2>
        <ul class="list-disc pl-5 space-y-2">
            {% for membership in group.memberships.all %}
            <li>
                {{ membership.member.full_name|default:membership.member.login_id }}
                {% if membership.role == 'admin' %}<span class="text-xs bg-blue-100 text-blue-800 font-semibold px-2 py-0.5 rounded-full ml-2">管理者</span>{% endif %}
                {% if membership.member == user %}<span class="text-xs bg-green-100 text-green-800 font-semibold px-2 py-0.5 rounded-full ml-2">あなた</span>{% endif %}
            </li>
            {% endfor %}
        </ul>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-lg text-center">
        <h2 class="text-2xl font-bold mb-4">メンバーを招待</h2>
        <p class="mb-4">このグループの招待コードを使って、メンバーを招待できます。</p>
        <div class="p-4 bg-gray-100 rounded-lg inline-block border">
            <p class="text-2xl font-mono tracking-widest">{{ group.invitation_code }}</p>
        </div>
        <p class="mt-4 text-sm text-gray-500">（QRコード機能は後ほど実装します）</p>
        <a href="{% url 'Sotsuken_Portable:group_invite_qr' group.pk %}" class="mt-4 inline-block bg-gray-300 text-gray-700 py-2 px-6 rounded-lg hover:bg-gray-400 font-semibold">
            招待用QRコードを表示
    </div>

    {% for membership in group.memberships.all %}
        {% if membership.member == user and membership.role == 'admin' %}
        <div class="mt-8 pt-8 border-t border-red-200">
            <h3 class="text-xl font-bold text-red-700 mb-4 text-center">管理者メニュー</h3>
            <div class="text-center">
                <a href="{% url 'Sotsuken_Portable:group_delete' group.pk %}" class="bg-red-600 text-white py-2 px-6 rounded-lg hover:bg-red-700 inline-block">
                    このグループを削除する
                </a>
            </div>
        </div>
        {% endif %}
    {% endfor %}

    {# --- 一般メンバー向けの脱退ボタン --- #}
<div class="mt-8 pt-8 border-t">
    <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">グループ設定</h3>
    <form method="post" action="{% url 'Sotsuken_Portable:group_leave' group.pk %}" onsubmit="return confirm('本当にこのグループから脱退しますか？');">
        {% csrf_token %}
        <div class="text-center">
            <button type="submit" class="text-red-600 hover:underline">
                このグループから脱退する
            </button>
        </div>
    </form>
</div>
</div>
{% endblock %}