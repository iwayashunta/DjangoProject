{% extends 'base.html' %}
{% load static %}

{% block title %}é¿é›£æ‰€æƒ…å ±ç·¨é›†{% endblock %}
{% block header_title %}é¿é›£æ‰€æƒ…å ±ç·¨é›†{% endblock %}

{% block content %}
<div class="p-4 md:p-8 max-w-4xl mx-auto">
    
    <form method="post" class="bg-white p-6 rounded-xl shadow-lg" onsubmit="return disableButton(this)">
        {% csrf_token %}
        <h3 class="text-lg font-semibold mb-6 text-blue-700 border-b pb-2">ã€Œ{{ shelter.name }}ã€ã®æƒ…å ±ã‚’ç·¨é›†</h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

            <!-- ç®¡ç†ID -->
            <div class="mb-2">
                <label for="{{ form.management_id.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.management_id.label }}</label>
                {{ form.management_id }}
                <p class="text-xs text-gray-500 mt-1">â€»IDã‚’å¤‰æ›´ã™ã‚‹ã¨é–¢é€£ãƒ‡ãƒ¼ã‚¿ã¨ã®ãƒªãƒ³ã‚¯ãŒåˆ‡ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã®ã§ã”æ³¨æ„ãã ã•ã„ã€‚</p>
            </div>

            <!-- é–‹è¨­çŠ¶æ³ -->
            <div class="mb-2">
                <label for="{{ form.opening_status.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.opening_status.label }}</label>
                {{ form.opening_status }}
            </div>

            <!-- é¿é›£æ‰€å -->
            <div class="mb-2">
                <label for="{{ form.name.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.name.label }}</label>
                {{ form.name }}
                {% if form.name.errors %}<p class="text-red-500 text-xs mt-1">{{ form.name.errors.0 }}</p>{% endif %}
            </div>

            <!-- ä½æ‰€ -->
            <div class="mb-2">
                <label for="{{ form.address.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.address.label }}</label>
                {{ form.address }}
            </div>

            <!-- æœ€å¤§åå®¹äººæ•° -->
            <div class="mb-2">
                <label for="{{ form.max_capacity.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.max_capacity.label }}</label>
                {{ form.max_capacity }}
            </div>

            <!-- ç¾åœ¨ã®åå®¹äººæ•° -->
            <div class="mb-2">
                <label for="{{ form.current_occupancy.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.current_occupancy.label }}</label>
                {{ form.current_occupancy }}
            </div>

            <!-- ãƒšãƒƒãƒˆåŒä¼´å¯ -->
            <div class="mb-2 flex items-center h-full pt-6 md:col-span-2">
                {{ form.is_pet_friendly }}
                <label for="{{ form.is_pet_friendly.id_for_label }}" class="ml-2 block text-sm font-medium text-gray-700">
                    {{ form.is_pet_friendly.label }}
                </label>
            </div>

            <!-- ä½ç½®æƒ…å ±ã‚¨ãƒªã‚¢ -->
            <div class="md:col-span-2 border-t pt-4 mt-2">
                <label class="block text-sm font-bold text-gray-700 mb-2">ä½ç½®æƒ…å ± (ãƒ”ãƒ³ç”¨)</label>

                <div class="flex gap-4 items-end">
                    <div class="flex-1">
                        <label class="text-xs text-gray-500">ç·¯åº¦</label>
                        {{ form.latitude }}
                    </div>
                    <div class="flex-1">
                        <label class="text-xs text-gray-500">çµŒåº¦</label>
                        {{ form.longitude }}
                    </div>

                    <!-- ç¾åœ¨åœ°å–å¾—ãƒœã‚¿ãƒ³ -->
                    <button type="button" onclick="getLocation()"
                            class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 text-sm font-bold h-10 mb-0.5">
                        ğŸ“ ç¾åœ¨åœ°ã§æ›´æ–°
                    </button>
                </div>
            </div>
        </div>

        <div class="flex justify-center gap-4 mt-8 pt-4 border-t border-gray-100">
            <a href="{% url 'Sotsuken_Portable:shelter_management' %}" class="w-full text-center bg-gray-200 text-gray-800 p-3 rounded-lg hover:bg-gray-300 font-semibold transition-colors">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</a>
            <button type="submit" class="w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 font-semibold transition-colors">ã“ã®å†…å®¹ã§æ›´æ–°</button>
        </div>
    </form>
</div>

<!-- ä½ç½®æƒ…å ±å–å¾—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
<script>
    function getLocation() {
        if (!navigator.geolocation) {
            alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚");
            return;
        }

        const btn = document.querySelector('button[onclick="getLocation()"]');
        const originalText = btn.innerText;
        btn.innerText = "å–å¾—ä¸­...";
        btn.disabled = true;

        navigator.geolocation.getCurrentPosition(
            (position) => {
                document.getElementById('id_latitude').value = position.coords.latitude.toFixed(6);
                document.getElementById('id_longitude').value = position.coords.longitude.toFixed(6);

                btn.innerText = "å®Œäº†ï¼";
                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.disabled = false;
                }, 2000);
            },
            (error) => {
                console.error(error);
                alert("ä½ç½®æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚");
                btn.innerText = originalText;
                btn.disabled = false;
            },
            { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
        );
    }
</script>
{% endblock %}